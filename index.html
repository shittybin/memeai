 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 <!-- THE FILE CONTAINS ALL IN ONE CODE -->
 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MemeAI - AI Powered Meme Generator</title>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'hot-pink': '#F15BB5',
                        'electric-blue': '#00BBF9',
                        'off-white': '#f9f9f9',
                    },
                    fontFamily: {
                        fredoka: ['"Fredoka One"', 'cursive'],
                        inter: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        .neubrutalist-box {
            border: 4px solid black;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
        }
        .neubrutalist-box:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }
        .loading {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }
        /* Fix: Make canvas responsive inside memePreview container */
        #memePreview {
    width: 100%;
    /* remove fixed aspect-ratio */
    display: flex;
    justify-content: center;
    align-items: center;
}

#memePreview canvas {
    width: 100%;
    height: auto; /* maintain image aspect ratio */
    display: block;
    max-height: 80vh; /* optional: limit max height to viewport */
}

    </style>
</head>
<body class="bg-off-white min-h-screen font-inter p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="font-fredoka text-5xl md:text-6xl mb-4 text-black">
                Meme<span class="text-hot-pink">AI</span>
            </h1>
            <p class="text-lg text-gray-700">Create viral memes with AI-powered captions!</p>
        </header>

        <div class="grid md:grid-cols-2 gap-8">
            <div class="space-y-6">
                <div class="neubrutalist-box bg-white p-6">
                    <h2 class="font-fredoka text-2xl mb-4">Choose Template</h2>
                    <select id="memeTemplate" class="w-full p-3 border-2 border-black rounded">
                        <option value="loading">Loading templates...</option>
                    </select>
                    <button
                        id="randomTemplate"
                        class="mt-4 w-full bg-electric-blue text-white font-bold py-3 px-6 neubrutalist-box"
                    >
                        <i class="bi bi-shuffle me-2"></i>Random Template
                    </button>
                </div>

                <div class="neubrutalist-box bg-white p-6">
                    <h2 class="font-fredoka text-2xl mb-4">Enter Topic</h2>
                    <input
                        type="text"
                        id="memeTopic"
                        placeholder="e.g. exams, aliens, breakups"
                        class="w-full p-3 border-2 border-black rounded mb-4"
                    />
                    <button
                        id="generateMeme"
                        class="w-full bg-hot-pink text-white font-bold py-3 px-6 neubrutalist-box"
                    >
                        <i class="bi bi-magic me-2"></i>Generate Meme
                    </button>
                </div>
            </div>

            <div class="neubrutalist-box bg-white p-6">
                <h2 class="font-fredoka text-2xl mb-4">Your Meme</h2>
                <div
                    id="memePreview"
                    class="relative w-full bg-gray-100 flex items-center justify-center"
                >
                    <p class="text-gray-500">Your meme will appear here</p>
                </div>
                <div class="flex gap-4 mt-6">
                    <button
                        id="downloadMeme"
                        class="flex-1 bg-electric-blue text-white font-bold py-3 px-6 neubrutalist-box"
                    >
                        <i class="bi bi-download me-2"></i>Download
                    </button>
                    <button
                        id="shareMeme"
                        class="flex-1 bg-hot-pink text-white font-bold py-3 px-6 neubrutalist-box"
                    >
                        <i class="bi bi-share me-2"></i>Share
                    </button>
                </div>
            </div>
        </div>
    </div>
    <br>
<small style="text-align: center;">Made with ☕️ by github.com/jsdingra11</small>
    <script>
        const memeTemplates = [];
        let currentMeme = null;

        async function fetchMemeTemplates() {
            try {
                const response = await fetch('https://api.imgflip.com/get_memes');
                const data = await response.json();
                if (data.success) {
                    memeTemplates.push(...data.data.memes);
                    populateTemplateSelect();
                }
            } catch (error) {
                console.error('Error fetching templates:', error);
            }
        }

        function populateTemplateSelect() {
            const select = document.getElementById('memeTemplate');
            select.innerHTML = memeTemplates
                .map((template) => `<option value="${template.id}">${template.name}</option>`)
                .join('');
        }

        async function generateMemeCaption(topic) {
            try {
                const response = await fetch(
                    'https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/ai',
                    {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer 2srYX9suUcZ1zYuAzfE1grPHjZi2',
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            messages: [
                                {
                                    role: 'user',
                                    content: [
                                        {
                                            type: 'text',
                                            text: `You are a meme expert. Generate a funny meme caption about ${topic}. Format as: Top text / Bottom text`,
                                        },
                                    ],
                                },
                            ],
                        }),
                    }
                );
                const data = await response.json();
                const [topText, bottomText] = data.message.split('/').map((text) => text.trim());
                return { topText, bottomText };
            } catch (error) {
                console.error('Error generating caption:', error);
                return { topText: 'Error generating', bottomText: 'Please try again' };
            }
        }

        function renderMeme(template, topText, bottomText) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;

                // Draw image
                ctx.drawImage(img, 0, 0);

                // Configure text style
                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 3;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';

                // Calculate font size based on canvas width
                const fontSize = canvas.width * 0.1;
                ctx.font = `bold ${fontSize}px Impact`;

                // Draw top text
                drawText(ctx, topText, canvas.width / 2, 10, canvas.width);

                // Draw bottom text
                ctx.textBaseline = 'bottom';
                drawText(ctx, bottomText, canvas.width / 2, canvas.height - 10, canvas.width);

                // Update preview
                const preview = document.getElementById('memePreview');
                preview.innerHTML = '';
                preview.appendChild(canvas);
                currentMeme = canvas;
            };

            img.crossOrigin = 'anonymous'; // Enable cross-origin for canvas use
            img.src = template.url;
        }

        function drawText(ctx, text, x, y, maxWidth) {
            const words = text.split(' ');
            let line = '';
            const lines = [];
            const lineHeight = ctx.measureText('M').width * 1.5;

            words.forEach((word) => {
                const testLine = line + word + ' ';
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth * 0.9) {
                    lines.push(line);
                    line = word + ' ';
                } else {
                    line = testLine;
                }
            });
            lines.push(line);

            lines.forEach((line, i) => {
                ctx.strokeText(line, x, y + i * lineHeight);
                ctx.fillText(line, x, y + i * lineHeight);
            });
        }

        document.getElementById('generateMeme').addEventListener('click', async () => {
            const templateId = document.getElementById('memeTemplate').value;
            const topic = document.getElementById('memeTopic').value;

            if (!topic) {
                alert('Please enter a topic!');
                return;
            }

            const template = memeTemplates.find((t) => t.id === templateId);
            const caption = await generateMemeCaption(topic);
            renderMeme(template, caption.topText, caption.bottomText);
        });

        document.getElementById('randomTemplate').addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * memeTemplates.length);
            document.getElementById('memeTemplate').value = memeTemplates[randomIndex].id;
        });

        document.getElementById('downloadMeme').addEventListener('click', () => {
            if (currentMeme) {
                currentMeme.toBlob((blob) => {
                    saveAs(blob, 'meme.png');
                });
            }
        });

        document.getElementById('shareMeme').addEventListener('click', () => {
            if (currentMeme) {
                currentMeme.toBlob(async (blob) => {
                    try {
                        await navigator.share({
                            files: [new File([blob], 'meme.png', { type: 'image/png' })],
                            title: 'Check out my AI-generated meme!',
                        });
                    } catch (error) {
                        alert('Sharing failed or not supported on this browser.');
                    }
                });
            }
        });

        fetchMemeTemplates();
    </script>
</body>
</html>
